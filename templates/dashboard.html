<!DOCTYPE html>
<html lang="en">
<head>
        <title>Dashboard</title>
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.3.1/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
        <!-- Font Awesome for icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link rel="stylesheet" href="/static/style.css">
</head>
<body>
        <nav class="navbar navbar-light bg-light">
            <span class="navbar-text mr-3">Welcome, {{ username }}</span>
            {% if is_admin %}
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-info ml-1">
                <i class="fas fa-user-shield"></i> Admin Dashboard
            </a>
            {% endif %}
            <button class="btn btn-primary ml-1" data-toggle="modal" data-target="#uploadModal">
                <i class="fas fa-upload"></i> Upload Files
            </button>
            <button class="btn btn-success ml-1" data-toggle="modal" data-target="#folderModal">
                <i class="fas fa-folder-plus"></i> New Folder
            </button>
            <a href="{{ url_for('logout') }}" class="btn btn-danger ml-1">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
        
    <!-- File Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Files or Folders</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <form action="{{ url_for('dashboard') }}" method="POST" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Upload Type:</label>
                            <div class="btn-group btn-group-toggle w-100 mb-3" data-toggle="buttons">
                                <label class="btn btn-outline-primary active">
                                    <input type="radio" name="uploadType" value="files" checked> Files
                                </label>
                                <label class="btn btn-outline-primary">
                                    <input type="radio" name="uploadType" value="folder"> Folder
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="fileUploadSection">
                            <label for="file">Select Files:</label>
                            <input type="file" class="form-control-file" id="file" name="file" multiple>
                        </div>
                        <div class="form-group d-none" id="folderUploadSection">
                            <label for="folder">Select Folder:</label>
                            <input type="file" class="form-control-file" id="folder" name="folder[]" webkitdirectory directory multiple>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Upload</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div class="modal fade" id="folderModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Folder</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <form action="{{ url_for('dashboard') }}" method="POST">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="folder_name">Folder Name:</label>
                            <input type="text" class="form-control" id="folder_name" name="folder_name" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Content Display -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Your Files and Folders</h4>
                    <div class="search-container" style="width: 400px;">
                        <div class="input-group">
                            <input type="text" id="fileSearch" class="form-control bg-dark text-light border-0" 
                                   placeholder="Search files and folders..." 
                                   style="border-radius: 5px; padding: 10px 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="input-group-append">
                                <span class="input-group-text bg-dark border-0 text-light">
                                    <i class="fas fa-search"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Size</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for folder in folders %}
                            <tr>
                                <td><i class="fas fa-folder text-warning"></i> {{ folder.name }}</td>
                                <td>Folder</td>
                                <td>-</td>
                                <td>{{ folder.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            </tr>
                            {% endfor %}
                            
                            {% for file in files %}
                            <tr>
                                <td><i class="fas fa-file text-primary"></i> {{ file.name }}</td>
                                <td>File</td>
                                <td>{{ file.size }} bytes</td>
                                <td>{{ file.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Required JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        #fileSearch::placeholder {
            color: #6c757d;
        }
        
        #fileSearch:focus {
            background-color: #1a1f24 !important;
            box-shadow: 0 0 0 0.2rem rgba(52, 144, 220, 0.25);
            outline: none;
        }
        
        .input-group-text {
            border-radius: 0 5px 5px 0;
        }
        
        .search-container .input-group {
            background-color: #1a1f24;
            border-radius: 5px;
        }
    </style>
    <script>
        document.getElementById('fileSearch').addEventListener('keyup', function() {
            const searchInput = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('table tbody tr');
            
            tableRows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const type = row.cells[1].textContent.toLowerCase();
                
                if (name.includes(searchInput) || type.includes(searchInput)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        document.querySelectorAll('input[name="uploadType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const fileSection = document.getElementById('fileUploadSection');
                const folderSection = document.getElementById('folderUploadSection');
                
                if (this.value === 'files') {
                    fileSection.classList.remove('d-none');
                    folderSection.classList.add('d-none');
                } else {
                    fileSection.classList.add('d-none');
                    folderSection.classList.remove('d-none');
                }
            });
        });
    </script>
</body>
</html>
